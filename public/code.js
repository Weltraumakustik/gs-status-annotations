"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function e(e,t,a,n){return new(a||(a=Promise))((function(i,o){function r(e){try{s(n.next(e))}catch(e){o(e)}}function l(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,l)}s((n=n.apply(e,t||[])).next())}))}let t=210,a=0,n=0;function i(e){let t=[];return e&&e.forEach(e=>{e.parent===figma.currentPage&&("COMPONENT"!==e.type&&"FRAME"!==e.type&&"INSTANCE"!==e.type&&"GROUP"!==e.type||(t.push(e),console.log(t)))}),t}function o(e){let t=e.id,a=figma.currentPage.findOne(e=>"GROUP"===e.type&&"status_annotations"===e.name),i=figma.currentPage.findAll(e=>"FRAME"===e.type&&"status_border"===e.name);e.setSharedPluginData("statusannotations","status",""),a&&(a.children.forEach(e=>{let a=e.getPluginData("frameId");t===a&&(e.remove(),n++)}),i.forEach(e=>{let a=e.getPluginData("frameId");t===a&&e.remove()}))}function r(){let e=figma.currentPage.findOne(e=>"GROUP"===e.type&&"status_annotations"===e.name);e&&(e.children.forEach(e=>{let t=e.getPluginData("frameId"),n=figma.getNodeById(t);if(n){let t=n.y-e.height-8,i=n.x+n.width-e.width;e.x!=i&&e.y!=t&&a++,e.x=i,e.y=t}else e.remove(),a++}),1===a?figma.notify("1 annotation updated"):a>1&&figma.notify(a+" annotations updated"),e.parent.insertChild(0,e)),a=0}function l(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:null}r(),"refresh"===figma.command?(r(),figma.closePlugin()):figma.showUI(__html__,{width:184,height:t}),figma.ui.onmessage=a=>{switch(a.type){case"height":t=a.height,figma.ui.resize(184,t);break;case"addStatus":!function(t){e(this,void 0,void 0,(function*(){let e=i(figma.currentPage.selection);if(0!==e.length){let i=0,r=figma.createFrame();r.counterAxisSizingMode="AUTO",r.layoutMode="HORIZONTAL",r.itemSpacing=4,r.horizontalPadding=6,r.verticalPadding=4,r.name="annotation",r.topLeftRadius=3,r.topRightRadius=3,r.strokes=[{type:"SOLID",visible:!0,opacity:1,blendMode:"NORMAL",color:l("#DBDBDB")}],r.strokeWeight=1;let s=figma.createText();s.name=t.title;let f={family:"Source Sans Pro",style:"Regular"};yield figma.loadFontAsync(f),s.fontName=f,s.fontSize=16,s.lineHeight={value:24,unit:"PIXELS"};var a=new Date;let c="("+(a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate())+") "+t.title;s.characters=c;let g=figma.createNodeFromSvg(t.icon);g.name="icon-"+t.slug,g.layoutAlign="CENTER",r.insertChild(0,s),r.insertChild(1,g);let u=[];u.push(r);let d=figma.group(u,figma.currentPage);d.name=t.title;let m=l(t.color);m=Object.assign({a:1},m),d.effects=[{blendMode:"NORMAL",color:m,offset:{x:0,y:-2},radius:0,type:"INNER_SHADOW",visible:!0}];let h=figma.createFrame();h.name="border",h.resizeWithoutConstraints(101,101),h.strokes=[{type:"SOLID",visible:!0,opacity:1,blendMode:"NORMAL",color:l(t.color)}],h.strokeWeight=2;const p=(n=h.fills,JSON.parse(JSON.stringify(n)));p[0].opacity=0,h.fills=p;let y=h;y.name="status_border",e.forEach(e=>{let a,n;o(e),0===i?(a=d,n=y):(a=d.clone(),n=y.clone());let r=e.id,l=e.y-a.height-8,s=e.x+e.width-a.width;a.x=s,a.y=l,e.appendChild(n),n.x=0,n.y=0,n.locked=!0,n.resize(e.width,e.height),a.setPluginData("frameId",r),n.setPluginData("frameId",r);let f=figma.currentPage.findOne(e=>"GROUP"===e.type&&"status_annotations"===e.name);if(f)f.appendChild(a),f.parent.insertChild(0,f);else{let e=[];e.push(a);let t=figma.group(e,figma.currentPage);t.name="status_annotations",t.locked=!0,t.expanded=!1,t.parent.insertChild(0,t)}"INSTANCE"!=e.type&&e.setRelaunchData({status:t.title}),e.setSharedPluginData("statusannotations","status",t.title),figma.currentPage.setRelaunchData({refresh:""}),i++})}else figma.notify("Please select a top level frame, component, or group");var n}))}(a.status);break;case"delete":!function(){let e=i(figma.currentPage.selection);0!==e.length?(e.forEach(e=>{o(e),"INSTANCE"!=e.type&&e.setRelaunchData({})}),1===n?figma.notify("1 annotation removed"):n>1&&figma.notify(n+" annotations removed")):figma.notify("Please select a frame, component, or group with a status");n=0}();break;case"deleteAll":!function(){let e=figma.currentPage.findOne(e=>"GROUP"===e.type&&"status_annotations"===e.name),t=figma.currentPage.findAll(e=>"FRAME"===e.type&&"status_border"===e.name);e&&(e.remove(),t.forEach(e=>{e.remove()}));i(figma.currentPage.children).forEach(e=>{"INSTANCE"!=e.type&&e.setRelaunchData({})}),figma.currentPage.setRelaunchData({}),figma.notify("All annotations removed")}();break;case"refresh":r()}};
